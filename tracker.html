<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Tracker | Eric Kazee</title>
    <link rel="stylesheet" href="src/styles.css">
    <link rel="stylesheet" href="src/tracker.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/config.js"></script>
    <script src="js/ai-features-secure.js"></script>
</head>
<body>
    <header>
        <nav>
            <h1><a href="index.html">Eric Kazee</a></h1>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="tracker.html" class="active">Job Tracker</a></li>
                <li><button id="logoutBtn" class="btn-secondary">Logout</button></li>
            </ul>
        </nav>
    </header>

    <main id="tracker-app">
        <!-- Loading state -->
        <div id="loading" class="loading">
            <p>Loading your job applications...</p>
        </div>

        <!-- Auth required message -->
        <div id="auth-required" class="auth-required" style="display: none;">
            <h2>Authentication Required</h2>
            <p>Please <a href="index.html">login</a> to access your job tracker.</p>
        </div>

        <!-- Dashboard content -->
        <div id="dashboard" style="display: none;">
            <!-- Stats Summary -->
            <section class="stats-summary">
                <div class="stat-card">
                    <h3 id="total-apps">0</h3>
                    <p>Total Applications</p>
                </div>
                <div class="stat-card">
                    <h3 id="active-apps">0</h3>
                    <p>Active</p>
                </div>
                <div class="stat-card">
                    <h3 id="interview-count">0</h3>
                    <p>Interviews</p>
                </div>
                <div class="stat-card">
                    <h3 id="response-rate">0%</h3>
                    <p>Response Rate</p>
                </div>
            </section>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button id="add-job-btn" class="btn-primary">+ Add New Job</button>
                <button id="setup-ai-btn" class="btn-secondary">ü§ñ Setup AI Features</button>
                <button id="manage-resume-btn" class="btn-secondary">üìÑ Manage Resume</button>
            </div>

            <!-- Job Pipeline (Kanban) -->
            <section class="pipeline">
                <div class="pipeline-column" data-status="to-review">
                    <h3>üìã To Review <span class="count">0</span></h3>
                    <div class="job-cards" id="to-review-cards"></div>
                </div>

                <div class="pipeline-column" data-status="bookmarked">
                    <h3>üìå Bookmarked <span class="count">0</span></h3>
                    <div class="job-cards" id="bookmarked-cards"></div>
                </div>

                <div class="pipeline-column" data-status="applying">
                    <h3>‚úçÔ∏è Applying <span class="count">0</span></h3>
                    <div class="job-cards" id="applying-cards"></div>
                </div>

                <div class="pipeline-column" data-status="applied">
                    <h3>üì§ Applied <span class="count">0</span></h3>
                    <div class="job-cards" id="applied-cards"></div>
                </div>

                <div class="pipeline-column" data-status="interview">
                    <h3>üíº Interview <span class="count">0</span></h3>
                    <div class="job-cards" id="interview-cards"></div>
                </div>

                <div class="pipeline-column" data-status="offer">
                    <h3>üéâ Offer <span class="count">0</span></h3>
                    <div class="job-cards" id="offer-cards"></div>
                </div>
            </section>
        </div>
    </main>

    <!-- Add/Edit Job Modal -->
    <div id="job-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 id="modal-title">Add New Job</h2>
            <form id="job-form">
                <input type="hidden" id="job-id">

                <label for="company">Company *</label>
                <input type="text" id="company" required>

                <label for="role">Role *</label>
                <input type="text" id="role" required placeholder="AI Adoption Specialist, etc.">

                <label for="location">Location</label>
                <input type="text" id="location" placeholder="Remote, Dallas, TX, etc.">

                <label for="source">Source</label>
                <input type="text" id="source" placeholder="LinkedIn, Indeed, Referral, etc.">

                <label for="job-url">Job Posting URL</label>
                <input type="url" id="job-url" placeholder="https://...">

                <label for="status">Status *</label>
                <select id="status" required>
                    <option value="To Review">To Review</option>
                    <option value="Bookmarked">Bookmarked</option>
                    <option value="Applying">Applying</option>
                    <option value="Applied">Applied</option>
                    <option value="Interview">Interview</option>
                    <option value="Offer">Offer</option>
                    <option value="Rejected">Rejected</option>
                </select>

                <label for="description">Job Description / Notes</label>
                <textarea id="description" rows="6" placeholder="Paste job description, requirements, notes..."></textarea>

                <div class="modal-actions">
                    <button type="button" class="btn-secondary" id="cancel-btn">Cancel</button>
                    <button type="submit" class="btn-primary">Save Job</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Resume Management Modal -->
    <div id="resume-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeResumeModal()">&times;</span>
            <h2>üìÑ Master Resume Management</h2>

            <div id="resume-content">
                <div class="resume-section">
                    <label for="master-resume">Master Resume (Markdown format):</label>
                    <textarea id="master-resume" rows="20" placeholder="Enter your master resume in Markdown format...
# Your Name
## Professional Summary
..."></textarea>
                </div>

                <div class="resume-section">
                    <label for="cover-letter-template">Cover Letter Template (Optional):</label>
                    <textarea id="cover-letter-template" rows="8" placeholder="Dear Hiring Manager,

I am writing to express my interest in..."></textarea>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn-secondary" onclick="closeResumeModal()">Cancel</button>
                    <button type="button" class="btn-primary" onclick="saveMasterResume()">Save Master Resume</button>
                </div>
            </div>
        </div>
    </div>

    <!-- AI Job Actions Modal -->
    <div id="ai-actions-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeAIActionsModal()">&times;</span>
            <h2 id="ai-modal-title">ü§ñ AI Actions</h2>

            <div id="ai-content">
                <div class="ai-action-section">
                    <h3>üìù Resume Tailoring</h3>
                    <p>Use AI to customize your resume for this specific job posting.</p>
                    <button id="tailor-resume-btn" class="btn-primary" onclick="tailorResumeForJob()">
                        ‚ú® Tailor Resume with AI
                    </button>
                    <div id="tailoring-status" class="status-message"></div>
                </div>

                <div class="ai-action-section" id="application-section" style="display: none;">
                    <h3>üìß Application Preparation</h3>
                    <p>Prepare your tailored application for submission.</p>
                    <select id="resume-version-select">
                        <option value="">Select a resume version...</option>
                    </select>
                    <button id="prepare-application-btn" class="btn-secondary" onclick="prepareApplication()" disabled>
                        üì§ Prepare Application
                    </button>
                    <div id="application-status" class="status-message"></div>
                </div>

                <div class="ai-action-section">
                    <h3>üìä Application History</h3>
                    <div id="job-events" class="events-list">
                        <p>Loading events...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Application Preview Modal -->
    <div id="application-preview-modal" class="modal">
        <div class="modal-content large">
            <span class="close" onclick="closeApplicationPreview()">&times;</span>
            <h2>üìß Application Preview</h2>

            <div class="application-preview">
                <div class="email-details">
                    <h3>Email Details</h3>
                    <p><strong>Subject:</strong> <span id="email-subject"></span></p>
                    <p><strong>To:</strong> Apply to this company manually</p>
                </div>

                <div class="email-body">
                    <h3>Cover Letter</h3>
                    <div id="cover-letter-preview" class="content-preview"></div>
                </div>

                <div class="resume-attachment">
                    <h3>Resume</h3>
                    <div id="resume-preview" class="content-preview"></div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn-secondary" onclick="closeApplicationPreview()">Close</button>
                    <button type="button" class="btn-primary" onclick="copyToClipboard()">üìã Copy All to Clipboard</button>
                </div>
            </div>
        </div>
    </div>

    <script src="src/tracker.js"></script>
</body>
</html>